# Notify School

A Python script designed to monitor Firefox desktop notifications for incoming emails and forward them to Telegram. This tool effectively bypasses the limitation of Google Family Link accounts which disable automatic email forwarding.

## Context

Google Family Link accounts for children restrict automatic email forwarding. This makes it challenging for parents to stay updated on school notifications without manually checking the child's inbox repeatedly. 

This script provides a workaround by monitoring local Linux desktop notifications generated by an open Gmail tab in Firefox. When a new email notification appears, the script captures it and sends the details (Sender and Subject) to your Telegram via a bot.

## Prerequisites

- **Linux OS** with a desktop environment using DBus for notifications.
- **Firefox** browser.
- **Python 3**.
- `dbus-monitor` utility (typically installed by default on most Linux distros).
- A **Telegram Bot** (from @BotFather) and your **Chat ID**.

## Installation

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd notify-school
    ```

2.  **Install Python dependencies:**
    ```bash
    pip install requests python-dotenv
    ```

## Configuration

1.  Create a `.env` file in the same directory as the script:
    ```bash
    touch .env
    ```

2.  Add your Telegram credentials to the `.env` file:
    ```ini
    TELEGRAM_BOT_TOKEN=your_telegram_bot_token
    TELEGRAM_CHAT_ID=your_telegram_chat_id
    ```

## Usage

1.  Open **Firefox** and log into the Gmail account you wish to monitor.
2.  Enable **Desktop Notifications** in Gmail settings (and allow them in Firefox permission prompts).
3.  Keep the Gmail tab open.
4.  Run the monitor script:
    ```bash
    python notify-school.py
    ```

As long as the script is running and the browser is open, you will receive a Telegram message whenever a new email notification is triggered by Firefox.

## Run as a Systemd Service

To keep the script running in the background automatically when you log in:

1.  **Edit the service file:**
    Open `school-notify.service` and ensure the `WorkingDirectory` and `ExecStart` paths match your setup.
    > **Note:** The default configuration uses `uv run`. If you are not using `uv`, change `ExecStart` to:
    > `ExecStart=/usr/bin/python3 notify-school.py`

2.  **Install the service file:**
    Copy or link the file to your systemd user directory:
    ```bash
    mkdir -p ~/.config/systemd/user
    cp school-notify.service ~/.config/systemd/user/
    ```

3.  **Enable and start the service:**
    ```bash
    systemctl --user daemon-reload
    systemctl --user enable --now school-notify.service
    ```

4.  **Check status:**
    ```bash
    systemctl --user status school-notify.service
    ```

## How it works

The script runs `dbus-monitor` in a subprocess to listen to the `org.freedesktop.Notifications` interface. It parses the output to identify notifications specifically from "Firefox". Upon detecting a notification, it extracts the sender and subject line and uses the Telegram Bot API to send a formatted alert. It includes a basic debounce mechanism to prevent duplicate alerts for the same email.
